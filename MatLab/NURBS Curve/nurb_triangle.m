%- Reset all
close all;
clear all;
clc;

%- Points

p0 = [1;0];
p1 = [0;0];
p2 = [1/2;1/2];
p3 = [1;1];
p4 = [3/2;1/2];
p5 = [2;0];
p6 = [1;0];

tri = [0 1 2 1 0; 0 1 0 0 0]; 

%- Weights
w = [1, 1/2, 1, 1/2, 1, 1/2, 1];

%- Knot vector.
%- t1 = [0, 0, 0, 1/3, 1/3, 2/3, 2/3, 1, 1, 1];
t1  = 0:0.0002:1;       
t11 = t1(t1(:)>=0   & t1(:)<=1/3);
t12 = t1(t1(:)>=1/3 & t1(:)<=2/3);
t13 = t1(t1(:)>=2/3 & t1(:)<=1);

%- Basis functions.
n02   = ((1/3-t11)./(1/3)).^2;                      %[0,1/3]
n12   = 2.*(t11./(1/3)).*((1/3-t11)./(1/3));        %[0,1/3]
n22_1 = ((t11)./(1/3)).^2;                          %[0,1/3]
n22_2 = ((2/3-t12)./(1/3)).^2;                      %[1/3,2/3]
n32   = 2.*((2/3-t12)./(1/3)).*((t12-1/3)./(1/3));  %[1/3,2/3]
n42_1 = ((t12-1/3)./(1/3)).^2;                      %[1/3,2/3]
n42_2 = ((1-t13)./(1/3)).^2;                        %[2/3,1]
n52   = 2.*((t13-2/3)./(1/3)).*((1-t13)./(1/3));    %[2/3,1]
n62   = ((t13-2/3)./(1/3)).^2;                      %[2/3,1]
figure('Name','Basis functions.','NumberTitle','off');
plot(t11,n02,'red',...
     t11,n12,'green',...
     t11,n22_1,'blue',t12,n22_2,'blue',...
     t12,n32,'yellow',...
     t12,n42_1,'black',t13,n42_2,'black',...
     t13,n52,'magenta',...
     t13,n62,'cyan');

%- Rational basis functions.

%-Sums
s1 = n02.*w(1) + n12.*w(2) + n22_1.*w(3);
s2 = n22_2.*w(3) + n32.*w(4) + n42_1.*w(5);
s3 = n42_2.*w(5) + n52.*w(6) + n62.*w(7);
st = s1 + s2 + s3;
%-Calculations
r02     = (n02.*w(1))./s1;
r12     = (n12.*w(2))./s1;
r22_1   = (n22_1.*w(3))./s1;
r22_2   = (n22_2.*w(3))./s2;
r32     = (n32.*w(4))./s2;
r42_1   = (n42_1.*w(5))./s2;
r42_2   = (n42_2.*w(5))./s3;
r52     = (n52.*w(6))./s3;
r62     = (n62.*w(7))./s3;
figure('Name','Rational basis functions.','NumberTitle','off');
plot(t11,r02,'red',...
     t11,r12,'green',...
     t11,r22_1,'blue',t12,r22_2,'blue',...
     t12,r32,'yellow',...
     t12,r42_1,'black',t13,r42_2,'black',...
     t13,r52,'magenta',...
     t13,r62,'cyan');
 
%-Curve
c1 = r02.*p0 + r12.*p1 + r22_1.*p2; 
c2 = r22_2.*p2 + r32.*p3 + r42_1.*p4;
c3 = r42_2.*p4 + r52.*p5 + r62.*p6;
figure('Name','Curve','NumberTitle','off');
plot(c1(1,:),c1(2,:),'red',c2(1,:),c2(2,:),'blue',c3(1,:),c3(2,:),'green', tri(1,:), tri(2,:), 'black');
xlabel('x');
ylabel('y');